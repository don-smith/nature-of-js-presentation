<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>API Days: JavaScript API Workshop</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/moon.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Workshop-specific styles -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Printing and PDF exports -->
    <script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
      <script src="lib/js/html5shiv.js"></script>
      <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <div id="watermark"></div>
      <div class="slides">

        <section>
          <img src="img/apidays-logo.png" alt="API Days Logo">
          <h1>The Nature of JS</h1>
          <div>Don Smith (<a href="http://twitter.com/locksmithdon">@locksmithdon</a>)</div>
          <div>Rich Churcher (<a href="http://twitter.com/richchurcher">@richchurcher</a>)</div>
        </section>

        <!-- SECTION 1 -->
        <section data-background="img/backgrounds/landscape.jpg">
          <h1>JavaScript: the Landscape</h1>
        </section>

        <section>
          <h1>Why JavaScript?</h1>
          <aside class="notes" data-markdown>
            * JS API consumption predates JS API provision by about 10 years. Asynchronous content loads date from late 90's, term AJAX coined in 2005.  
            * Server-side JavaScript using Node since 2009
          </aside>
        </section>

        <section data-background="img/backgrounds/monkey_small.jpg">
          <h1 class="offset-bottom">Immediacy</h1>
          <aside class="notes" data-markdown>
            * Supremely easy to get started, essentially zero cost entry point...
            * Potentially same developers on front and back end
            * Quick design-code-test-debug cycles
          </aside>
        </section>

        <section data-background="img/backgrounds/rhino.jpg">
          <h1 class="offset-top">Reliability</h1>
          <aside class="notes" data-markdown>
            * Infrastructure investments (Google: V8, Microsoft: Chakra)
            * Large, mainstream frameworks (Google: Angular, Facebook: React)
            * Thriving community (Node.js/IO.js/4.0, and NPM modules)
            * As of Oct 2015, over 195K NPM packages
          </aside>
        </section>

        <section data-background="img/backgrounds/baby_koala.jpg">
          <h1 class="offset-top">Portability</h1>
          <aside class="notes" data-markdown>
            * Not only capable of building frontend and backend web, but mobile and desktop
            * Blurring lines between browser and native (React Native, Phonegap)
            * No longer the wild west: *ES6*
          </aside>
        </section>

        <section data-background="img/backgrounds/ants.jpg">
          <h1 class="offset-bottom">Maintainability</h1>
          <aside class="notes" data-markdown>
            * Simple, well-established mechanisms for sharing and troubleshooting code (REPLs everywhere: jsfiddle.net, jsbin.com, plnkr.io, codepen.io)
            * _Lingua franca_ effect: finding JS devs not difficult (quality variable)
            * Reasonable debugging tools using the browser and nodemon
            * Voracious (and opinionated) community
          </aside>
        </section>

        <section data-background="">
          <h1>Why not JavaScript?</h1>
        </section>

        <section data-background="img/backgrounds/kea_rope.jpg">
          <h1 class="offset-bottom">Tooling</h1> 
          <aside class="notes" data-markdown>
            * Even today, with WebStorm, and Visual Studio incorporating JS debugging, still not as good as statically typed languages
            * Can be hard to debug, particularly larger code bases
          </aside>
        </section>

        <section data-background="img/backgrounds/flock.jpg">
          <h1>Framework churn</h1>
          <aside class="notes" data-markdown>
            * Makes assessing the correct tool for a particular task more challenging
            * May mean poorer documentation, out of date tutorials, lost time
          </aside>
        </section>

        <section data-background="img/wombat.gif">
          <h1 class="offset-top">Speed</h1>
          <aside class="notes" data-markdown>
            * Traditional response to speed concerns around JS is, "processing speed always increases"
            * Compared with Go and other compiled backend languages
          </aside>
        </section>

        <section data-background="img/backgrounds/zebras.jpg">
          <h1>Regional preference</h1>
          <aside class="notes" data-markdown>
            * Full-stack JavaScript perhaps less common in New Zealand
              - May mean delays in finding developers for support/maintenance, although this is changing
          </aside>
        </section>


        <section data-background="">
          <h1>Why Web APIs?</h1>
        </section>

        <section data-background="img/backgrounds/urchins.jpg">
          <h1 class="offset-top">Decoupled</h1>
          <aside class="notes" data-markdown>
            * UX can be developed independently
              * Arbitrary partitioning: microservices or monolithic
              * Arbitrary language/stack, everything groks JSON
            * Common formats (JSON: .doc for the web?)
            * Can be versioned independently
          </aside>
        </section>

        <section data-background="img/backgrounds/giraffe.jpg">
          <h1>Expose public data sets</h1>
          <aside class="notes" data-markdown>
            * Independent of consuming applications
            * Consumers at organisational level, paying clients, or open
          </aside>
        </section>

        <section data-background="img/backgrounds/polar.jpg">
          <h1>Clear expectations</h1>
          <aside class="notes" data-markdown>
            * Simple and straight-forward requests response model
            * Discovery through HATEOAS Level 3 of the Richardson Maturity Model
              - HATEOAS: Hypertext As The Engine Of Application State
            * Good debugging tools like Postman
          </aside>
        </section>


        <section data-background="">
          <h1>Why not Web APIs?</h1>
          <aside class="notes" data-markdown>
            * Every request across HTTP has latency
          </aside>
        </section>

        <section>
          <h2>Further reading</h2>
          <ul>
            <li> <a href="http://www.infoworld.com/article/2907190/javascript/javascript-will-lead-a-massive-shift-in-enterprise-development.html">JavaScript will lead a massive shift in enterprise development</a></li>
          </ul>
        </section>


        <!-- SECTION 2 -->
        <section data-background="img/backgrounds/night_lake.jpg">
          <h1>JavaScript: Surviving in the wild</h1>
        </section>


        <section data-background="img/backgrounds/chameleon.jpg">
          <h1>When is JavaScript... not JavaScript?</h1>
          <h2 class="fragment">EcmaScript</h2>
          <h2 class="fragment">ES6</h2>
          <h2 class="fragment">ES2015</h2>
          <aside class="notes" data-markdown>
            * JavaScript is the common/generic name of the language. 
              * EcmaScript refers to the languageâ€™s specification. 
                * ES6 refers to the 6th edition of that spec. 
                * EcmaScript 2015 is the title of the 6th edition of the spec. 
            * Yes, we know this is ridiculous, but you will most certainly run across all of these on the web. 
            * For the purpose of this workshop, we will use _JavaScript_ as much as possible, and _ES6_ when we are referring to a language feature that was added in the latest version of the spec only because it has fewer syllables when pronounced."
            * All examples in this workshop assume _strict mode_. Incorporating [Babel](https://babeljs.io) into your workflow will take care of this for you. All _ES6_ modules are in strict mode by default.
          </aside>
        </section>

        <section>
          <section>
            <h2>Function level scope</h2>
            <ul>
              <li>Unlike languages with <em>block level scope</em>, in JavaScript blocks do not create their own restricted scope</li>
            </ul>
            <pre><code class="js">function foo () {
  for (var i = 0; i < 10; i++) { }

  console.log(i); // 10
}</code></pre>
            <ul>
              <li>Here, <code>i</code> is available anywhere within <code>foo</code></li>
            </ul>
            <aside class="notes" data-markdown>
              * In the past, was often recommended that `var` statements occur at the beginning of functions to avoid unwelcome surprises caused by this behaviour
                * With _ES6_, `var` can largely be replaced by `let`
              * https://jsbin.com/memopi/edit?js,console
            </aside>
          </section>

          <section>
            <h2><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/let"><code>let</code></a> </h2>
            <ul>
              <li>Restricts scope to its block, statement or expression:</li>
            </ul>
            <pre><code class="js">function bar () {
  for (let i = 0; i < 10; i++) { }

  console.log(i); // undefined
}</code></pre>

            <aside class="notes" data-markdown>
              * https://jsbin.com/warevab/edit?js,console
            </aside>
          </section>

          <section>
            <h2><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const"><code>const</code></a> </h2>

            <ul>
              <li> Creates a reference to a value that cannot be altered:</li>
            </ul>
            <pre><code class="js">// TypeError: assignment to constant
function wombat () {
  const n = 5;
  n++;
}</code></pre>
            <aside class="notes" data-markdown>
              * https://jsbin.com/jizivi/1/edit?js,console
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2>Closures</h2>

            <ul>
              <li> Functions can be declared inside other functions</li>
              <li> local variables in the outer function are still available <em>even if the outer function has already returned</em></li>
            </ul>
          </section>
          <section>
            <pre><code class="js">function foo() {
  let n = 1;
  return bar;

  function bar() {
    // bar "closes over" n
    console.log(n++); 
  }
}

let baz = foo();
baz();          // 1
baz();          // 2

let wombat = foo();
wombat();       // 1
baz();          // 3</code></pre>
            <aside class="notes" data-markdown>
              * https://jsbin.com/cibibe/1/edit?js,console
            </aside>
          </section>
          <section>
            <ul>
              <li> Here, <code>n</code> remains "alive" and can be modified after <code>foo</code> exits.  </li>
              <li> Each call to <code>foo</code> creates a new <em>closure</em>, with its own local copy of <code>n</code>.  </li>
            </ul>
          </section>
        </section>

        <section>

          <section>
            <h2><code>this</code></h2>
            <ul>
              <li>In <em>ES6</em> the value of <code>this</code> is fairly predictable</li>
              <li> Watch out for legacy JS, where it can unexpectedly default to the window object and lead to some unintuitive behaviour</li>
              <li>Best practice is to <em>be explicit</em></li>
            </ul>
            <aside class="notes" data-markdown>
              * Best practice is to _be explicit_: never assume that the next developer to read your code understands the nuances of `this`
              * Think _functionally_: avoid altering global or object level state
            </aside>
          </section>

          <section>
            <ul>
              <li>Value of <code>this</code> depends on the execution context:</li>
            </ul>

            <pre><code class="js">// Value of 'this' set to Window object
console.log(this);   

function foo () {
  console.log(this); // undefined
}

let bar = {
  wombat: function () {
    // Value of 'this' is the object the 
    // method is called on: 'bar' in this case
    console.log(this); 
  }
};</code></pre>
          </section>

          <section>
            <ul>
              <li><code>this</code> can be tricky when used in event handlers. Generally its value is the DOM element which fired the event:</li>
            </ul>
            <pre><code class="js">let foo = document.getElementById('foo');
foo.onclick = makeGreen;

function makeGreen() {
  // 'this' is the &lt;p&gt; DOM element
  this.style.backgroundColor = 'green';
}</code></pre>
          </section>

          <section>
            <ul>
              <li>But when a function isn't called as a method of an object...</li>
            </ul>
            <pre><code class="js">let foo = document.getElementById('foo');
foo.onclick = toggleGreen;

function toggleGreen() {
  if (this.style.backgroundColor === 'green') {
    makeTransparent();
  } else {
    makeGreen();
  }
}

function makeGreen() {
  this.style.backgroundColor = 'green'; // undefined
}

function makeTransparent() {
  this.style.backgroundColor = 'transparent'; // undefined
}</code></pre>
          </section>

          <section>
            <ul>
              <li>Use of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call"><code>call</code></a> invokes a function with the desired value of <code>this</code>:</li>
            </ul>
              <pre><code class="js">if (this.style.backgroundColor === 'green') {
  makeTransparent.call(this);
}</code></pre>
            <ul>
              <li>Compare <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind"><code>bind</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply"><code>apply</code></a></li>
            </ul>
            <aside class="notes" data-markdown>
              * https://jsbin.com/xirapa/1/edit?js,console,output
              * Cross-browser issues (particularly with earlier versions of Internet Explorer) can yield surprising results, with <code>this</code> being set to the global window object.</li>
              </ul>
            </aside>
          </section>

        </section>

        <section>

          <section>
            <h2>The object prototype</h2>

            <ul>
              <li>In JavaScript every object has its own <em>prototype</em></li>
              <li>Each prototype has its own prototype, and so on down the chain until <code>null</code> is reached</li>
              <li>Properties are first looked for in the object itself (see: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty"><code>hasOwnProperty</code></a>) then in its prototype, then in the prototype's prototype, and so on</li>
            </ul>
          </section>

          <section>
            <ul>
              <li>It's useful to remember the difference between giving one distinct object a property ...</li>
            </ul>
            <pre><code class="js">let foo = {
  aardvarks: function() { 
    console.log("I see many aardvarks.");
  }
};

foo.aardvarks(); // I see many aardvarks</code></pre>
          </section>

          <section>
            <ul>
              <li>... and giving all objects created with a particular constructor function access to the property:</li>
            </ul>
            <pre><code class="js">function AardvarkCounter(n) {
  this.count = n;
}

AardvarkCounter.prototype.aardvarks = function() {
  console.log(`I see ${this.count} aardvarks.`);
};

let firstCounter = new AardvarkCounter(11);
let secondCounter = new AardvarkCounter(1337);

firstCounter.aardvarks();  // "I see 11 aardvarks."
secondCounter.aardvarks(); // "I see 1337 aardvarks."</code></pre>

            <aside class="notes" data-markdown>
              * https://jsbin.com/kohese/1/edit?js,console
            </aside>
          </section>

          <section>
            <ul>
              <li>Functions declared on the prototype are shared between all objects with that prototype</li>
              <li>Many libraries include the ability to copy properties from one object to another</li>
              <li>For example, using <a href="http://underscorejs.org">Underscore's</a> <a href="http://underscorejs.org/#extend"><code>extend</code></a>:</li>
            </ul>
            <pre><code class="js">let foo = {
  n: 5
};

let bar = {
  wombat: function() {
    console.log("Wombats: accept no substitute.");
  }
};

let combined = _.extend(foo, bar);
combined.wombat();
console.log(combined.n); // 5</code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Modules and Imports</h2>

            <ul>
              <li>To make a property, function, or object available outside its own file (<em>module</em>), prefix it with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export"><code>export</code></a> keyword:</li>
            </ul>
              <pre><code class="js">// wombats.js

export const metabolism = 4;

export function showWombats() {
  // ...
};</code></pre>
              <aside class="notes" data-markdown>
                * https://gist.github.com/locksmithdon/96fb0ae2904f86c86e66
              </aside>
          </section>

          <section>
            <ul>
              <li>To make use of this in another module, we use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a>. The following will all make <code>showWombats</code> available:</li>
            </ul>
              <pre><code class="js">// Import the entire module
import wombats from './wombats';

// Just one function
import {showWombats} from './wombats';

// Same as above, but give it a shorter alias
import {showWombats as sw} from './wombats';</code></pre> 
            <ul>
              <li> In the first statement, <code>showWombats</code> would be referred to as <code>wombats.showWombats</code></li>
            </ul>
          </section>
        </section>

        <section>
          <section>
            <h2>Underscore and Lo-Dash</h2>

            <ul>
              <li>Utility libraries act as extensions to the JavaScript standard library, providing consistent and well-tested ways to interact with data structures.</li>
              <li>The two most popular are <a href="http://underscorejs.org">Underscore</a> and its API-compatible alternative, <a href="http://lodash.com">Lo-Dash</a></li>
            </ul>

            <aside class="notes" data-markdown>
              * If you've ever wished that JavaScript had <em>X</em> feature from another language, chances are it (or something like it) is provided by a utility library
              * One of the key roles of a utility library is making it simpler, more expressive, and less error-prone to work with data structures (an array, object, or string).
              * The question of which one to use has gotten quite political, and beyond our scope here. Either one will run the examples.
            </aside>
          </section>

          <section>
            <ul><li>Given an array:</li></ul>
            <pre><code class="js">let aardvarks = [
  "Snuffler", "Stinker", "Slappy", "Sadface"
];</code></pre>
            <ul><li>You could do this:</li></ul>
            <pre><code class="js">for (let i = 0; i < aardvarks.length; i++) {
  console.log(aardvarks[i]);
}</code></pre>
            <ul><li>Or this:</li></ul>
            <pre><code class="js">_.each(aardvarks, console.log);</code></pre>
          </section>

          <!-- 

            I'm leaving these sections in for now, but I'm hiding 
            them because I think it might be a bit too much. Plus 
            a lot of lodash/underscore isn't needed with ES6.

          <section>
            <ul>
              <li>Checking if an object has a particular propery is another common use case:</li>
            </ul>
            <pre><code class="js">let wombat = {
  registeredToVote: false,
  highlyOpinionated: true
};

if (_.contains(_.keys(wombat), 'registeredToVote')) {
  console.log("This marsupial is registered to vote.");
}</code></pre>
          </section>

          <section>
            <ul>
              <li>Some standard library functions are duplicated:</li>
            </ul>

            <pre><code class="js">// Standard library
let sum1 = [1, 2, 3, 4, 5].reduce( function (prev, curr) {
  return prev + curr;
});

// Underscore / Lo-Dash
let sum2 = _.reduce([1, 2, 3, 4, 5], function (total, n) {
  return total + n;
});

// Alternative syntax
let sum3 = _([1, 2, 3, 4, 5]).reduce( function (total, n) {
  return total + n;
});

console.log(sum1, sum2, sum3); // 15 15 15</code></pre>

            <aside class="notes" data-markdown>
              * Why not use the standard library version?
              * The same approach to work with anything that can be treated as a container (objects, strings, and arrays), so we don't need to explicitly convert to array and back again. This can give our code consistency and readibility.
              * In some circumstances, the library will default to the native version if it's known to be faster in a given environment.
            </aside>
          </section>

          -->

        </section>

        <section>
          <h2>Further Reading</h2>

          <ul>
            <li>
              <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/let">let</a>, 
              <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const">const</a>, 
              <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a> (MDN)
            </li>
            <li><a href="http://stackoverflow.com/a/111111/122643">Closures - canonical Stack Overflow answer</a></li>
            <li><a href="http://bjorn.tipling.com/all-this">all this</a></li>
            <li>
              <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">call</a>,
              <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">apply</a>,
              <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_objects/Function/bind">bind</a> (MDN)
            </li>
            <li><a href="http://www.sitepoint.com/javascript-this-event-handlers/">JavaScript 'this' and event handlers</a></li>
            <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">Inheritance and the prototype chain</a></li>
            <li><a href="http://colintoh.com/blog/lodash-10-javascript-utility-functions-stop-rewriting">Lodash: 10 JavaScript Utility Functions That You Should Probably Stop Rewriting</a></li>
            <li><a href="http://blog.xebia.com/2015/08/11/you-might-not-need-lodash-in-your-es2015-project">You might not need lodash in your ES2015 Project</a>
            <li><a href="https://babeljs.io/docs/learn-es2015/">Learn ES2015</a></li>
            <li><a href="http://exploringjs.com/es6/">Exploring ES6</a> (free online book)</li>
          </ul>
        </section>


        <!-- SECTION 3 -->
        <section data-background="img/backgrounds/log.jpg">
          <h1 class="offset-bottom">The Ecosystem</h1>
        </section>

        <section>
          <p>Today, the JavaScript ecosystem is in a constant state of ... innovation ... as millions of developers contribute to client-side and server-side libraries and tools.</p>
            <p>We couldn't possibly present an exhaustive overview of the ecosystem, but we think the following tools are mandatory for most JavaScript developers to at least be familiar with.</p>
        </section>

        <section>

          <section>
            <h2>npm</h2>

            <ul>
              <li>Since its release in 2009, the <a href="https://www.npmjs.com">Node package manager</a> has become one of the most prolific package managers in the world </li>
              <li>Share packaged modules of JavaScript code</li>
              <li>Stipulate versions (or version ranges) for package dependencies</li>
              <li>npm Registry contains over 195,000 modules: the largest of all package repositories</li>
              <li>Can install packages <em>locally</em> or <em>globally</em></li>
            </ul>
          </section>

          <section>
            <pre><code class="json">{
  "name": "Aardvarks Ahoy",
  "version": "0.0.0",
  "description": "Orycterapus after",
  "main": "server.js",
  "repository": "https://iamnotarealrepository",
  "author": "Rich Churcher &lt;foo@wombat.com&gt;",
  "dependencies": {
    "express": "~3.2.4",
  },
  "devDependencies": {
    "babel": "^5.8.23",
    "babelify": "^6.3.0",
    "browserify": "^11.1.0",
    "gulp": "^3.9.0",
    "gulp-babel": "^5.2.1",
    "gulp-concat": "^2.6.0",
  }
}</code></pre>
          </section>

          <section>
            <ul>
              <li>Each package keeps a copy of its own dependencies in a nested folder structure (under <code>node_modules</code>)</li>
              <li>This causes a lot of duplication on the server's file system, but since we're not running JavaScript in the browser it's rarely a problem</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Bower</h2>

            <ul>
              <li>Bower is ideally suited to managing packages for the client, because unlike npm it doesn't nest dependencies: there's only one copy of each</li>
              <li>Much lighter weight, faster page loads</li>
              <li>Interacts with Git, can install directly from a repository</li>
              <li>Very common to use a combination of Bower and npm: they're not mutually exclusive</li>
              <li>Controlled by <code>bower.json</code>:</li>
            </ul>
          </section>

          <section>
            <pre><code class="json">{
  "name": "Aardvarks Ahoy",
  "description": "Orycterapus after",
  "version": "0.0.0",
  "homepage": "https://thisisnotthehomepage.io",
  "authors": [
    "Rich Churcher &lt;foo@wombat.com&gt;"
  ],
  "main": "js/app.js",
  "moduleType": [ "amd", "es6", "node" ],
  "keywords": [ "aardvark" ],
  "license": "MIT",
  "ignore": [ "**/.*", "node_modules", "bower_components" ],
  "dependencies": {
    "jquery": "~2.1.4",
    "lodash": "~3.10.1"
  }
}</code></pre>
          </section>

          <section>
            <ul>
              <li>The above or something very like it would be generated with the following terminal commands:</li>
            </ul>
            <pre><code class="bash">npm i bower --save-dev
bower init
bower install jquery lodash --save</code></pre>

            <ul>
              <li><code>bower init</code> fills most of the details out for you, including grabbing the GitHub repo as homepage, and adding any previously installed components</li>
              <li>Subsequently, components can be included directly from <code>bower_components/packagename/packagename.js</code> or similar</li>
            </ul>
          </section>
        </section>

        <section>

          <section>
            <h2>Gulp</h2>

            <ul>
              <li>Unlike <a href="#npm">npm</a> and <a href="#bower">Bower</a>, Gulp is a <em>build system</em> and not a package manager</li>
              <li>Also referred to as a <em>task runner</em></li>
            </ul>

            <aside class="notes" data-markdown>
              * Typically used for:
              * Concatenation and minification of source files, other deployment-related tasks
              * Compiling your CSS/Sass
              * Running a transpiler, allowing you to use _ES6_ features
              * Running test suites
              * Compressing images
              * Watching files for changes
            </aside>
          </section>

          <section>
            <ul>
              <li>Gulp can be used with both client and server-side projects</li>
              <li>Uses node streams</li>
              <li> Reads source files, pipes the text through plugins, and writes output</li>
              <li>Wide variety of plugins: uses <a href="#npm">npm</a> packages</li>
              <li>Compares to <a href="http://gruntjs.com">Grunt</a>, another widely-used task runner</li>
              <li>Controlled with <code>gulpfile.js</code>.</li>
            </ul>
          </section>

          <section>
            <pre><code class="js">gulp.task('js', function () {
  return gulp.src('js/**/*.js')
    .pipe(sourcemaps.init())
      .pipe(concat('app.js'))
      .pipe(uglify(true))
    .pipe(sourcemaps.write())
    .pipe(gulp.dest('dist'));
});

gulp.task('test', function (done) {
  new Server({
    configFile: 'test/karma.conf.js',
    singleRun: true
  }, done).start();
});

gulp.task('watch', ['js'], function () {
  gulp.watch('js/**/*.js', ['js', 'test']);
});</code></pre>

            <aside class="notes" data-markdown>
              * The `js` task does the following:
              * Suck every JavaScript file in `js` and its subdirectories into a stream
              * Starts a [sourcemap](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/): a way to retain the ability to debug minified code
              * Pass the stream through `concat`, which (surprise!) concatenates all the files into one, naming it `app.js`
              * Pass the stream through `stripDebug`, which removes all those pesky `console.log`s
              * Pass the stream through `uglify`, which minifies it
              * Finishes the sourcemap
              * Writes the stream to the destination directory.
              * The `test` task runs the unit test suite
              * The `watch` task above will keep an eye on files with the `.js` suffix and run first the `js` task, then the tests, for each code change
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2>Browserify</h2>

            <ul>
              <li>Bundles the dependencies for your project, letting you program with modules while browser support for <em>ES6</em> and <code>import</code>/<code>export</code> is still patchy</li>
              <li>Can also handle minification and other pre-deployment tasks</li>
              <li>Can be used from the command line or within the context of other tools such as <a href="#gulp">Gulp</a>:</li>
            </ul>
          </section>

          <section>
            <pre><code class="js">var gulp = require('gulp');
var browserify = require('browserify');
var babelify = require('babelify');
var source = require('vinyl-source-stream');

var bundler = browserify({
    entries: './src/main.js', 
    extensions: ['.js'], 
    debug: true
});

gulp.task('default', function () {
    return bundler
        .transform(babelify)
        .bundle()
        .pipe(source('app.js'))
        .pipe(gulp.dest('js'));
});</code></pre>
            <aside class="notes" data-markdown>
              * To walk through the above `gulpfile.js`:
              * Create a `bundler` using Browserify which begins at `main.js` and scoops up everything that app.js requires to work (dependencies)
              * Pass it through a transform using `babelify`, which is specifically designed to create _ES5_ output from _ES6_ JavaScript
              * Bundle it all up
              * Pipe the result into a file named `app.js`
              * Write `app.js` into the `js` destination directory
            </aside>
          </section>

        </section>

        <section data-background="img/backgrounds/kea_car.jpg">
          <h1 class="offset-bottom">Testing</h1>
        </section>

        <section>
          <section>
            <h2>Jasmine</h2>

            <ul>
              <li>A long-standing <a href="https://en.wikipedia.org/wiki/Behavior-driven_development">behaviour-driven</a> test framework</li>
              <li>Probably as close to a 'standard' as JavaScript has, although alternatives are growing in popularity</li>
              <li>Tests are just JavaScript files, which can contain any code you like</li>
            </ul>
          </section>

          <section>
            <pre><code class="js">describe('Wombat Counter', function() {
  describe('GET /', function() {

    it('responds with HTTP status 200', function() {
      request.get(base_url, function(error, response, body) {
        expect(response.statusCode.toBe(200));
      });
    });

  });
});</code></pre>
          </section>

          <section>
            <ul>
              <li>Jasmine comes with its own assertion tools:</li>
            </ul>
            <pre><code class="js">expect(countTheAardvarks()).toEqual(9);

expect("I'm a wombat").toContain('wombat');

expect(countTheAardvarks()).not.toEqual(8);</code></pre>
          </section>
          <section>
            <ul>
              <li>It also has <em>spies</em>: a way to keep tabs on parts of your program where it's not simple to track what's happening, like methods/functions</li>
            </ul>
            <pre><code class="js">var a = new ArmouryOfAardvarks();
spyOn(a, 'countTheAardvarks');
a.showPopulation();

// Did showPopulation call countTheAardvarks?
expect(a.countTheAardvarks).toHaveBeenCalled();</code></pre>
          </section>
        </section>

        <section>

          <section>
            <h2>Mocha</h2>

            <ul>
              <li>Similar on the surface to Jasmine</li>
              <li>Uses third party libraries for assertions, runners and spies</li>
              <li>The framework decision is less important than ensuring good test coverage</li>
            </ul>

            <aside class="notes" data-markdown>
              * On the surface, Mocha looks very similar to Jasmine but there are some important differences:
              * Mocha doesn't have an assertion tool or spies, preferring third party libraries for this purpose
              * (see <a href="#chai">Chai</a> and <a href="#sinon">Sinon</a>, below)
              * Mocha can be considered more flexible, but requires a bit more setup/configuration before use than Jasmine
              * For many uses there will be little difference between Jasmine, Mocha, and `[insert library here]`.
              * The take-home message is, it's probably more important that your app has good test coverage than spending time worrying about which framework to use!
            </aside>
          </section>

          <section>
            <h2>Chai</h2>
            <ul>
              <li><a href="http://chaijs.com">Chai</a> is perhaps the most popular assertion library for Mocha.</li>
              <li><em>assert</em>:</li>
            </ul>
            <pre><code class="js">assert.typeOf(foo, 'string', 'Yup, that is a string.');
assert.lengthOf(aardvarkArmoury, 9, 'There are 9 aardvarks.');</code></pre>
            <ul><li><em>BDD</em>:</li></ul>
            <pre><code class="js">expect(foo).to.equal('bar');
expect(bar).to.have.property('population').with.length(9);</code></pre>
            <ul><li><em>should</em> (extends each object with a new property):</li></ul>
            <pre><code class="js">bar.should.have.property('population').with.length(9);</code></pre>
          </section>
        </section>

        <section>
          <h2>Further Reading</h2>
          <ul>
            <li><a href="https://markgoodyear.com/2014/01/getting-started-with-gulp/">Getting Started with Gulp</a></li>
            <li><a href="https://medium.com/@preslavrachev/gulp-vs-grunt-why-one-why-the-other-f5d3b398edc4">Gulp vs Grunt. Why one? Why the Other?</a></li>
            <li><a href="http://thejsguy.com/2015/01/12/jasmine-vs-mocha-chai-and-sinon.html">Jasmine vs. Mocha, Chai, and Sinon</a></li>
            <li><a href="http://www.macwright.org/2014/03/11/tape-is-cool.html">TAP &amp; Tape, the awesome way to test JavaScript</a></li>
          </ul>
        </section>


        <!-- SECTION 4 -->
        <section data-background="img/backgrounds/sheep.jpg">
          <h1 class="offset-bottom">Asynchronous JavaScript</h1>
        </section>

        <section>
        <section>
          <h2>Callbacks</h2>
            <ul>
              <li>Also called the <em>Continuation Passing Style (CPS)</em></li>
              <li>Can be used with synchronous or asynchronous functions</li>
              <li>Called when an event occurs, or when the function completes</li>
            </ul>
        </section>

        <section>
          <ul>
            <li>Passing a callback into a synchronous function</li>
          </ul>
          <pre><code class="js">function displayResults(results) {
  for (let i = 0; i < results.length; i++) {
    console.log(results[i]);
  }
}

function incrementAll(numbers, callback) {
  for (let i = 0; i < numbers.length; i++) {
    numbers[i] += 1;
  }
  callback(numbers);
}

incrementAll([1, 2, 3, 4, 5], displayResults);</code></pre>
          <aside class="notes" data-markdown>
            * Here, the function `displayResults` is passed as a _callback_ to `incrementAll`.
            * It outputs values to the console, but we could just as easily pass in a function which further modifies the array
            * Many JavaScript standard library functions use callbacks, often optionally. For example:
          </aside>
        </section>

        <section>
          <pre><code class="js">function even(n) {
  return n % 2;
}

console.log([1, 2, 3, 4, 5].filter(even)); // [1, 3, 5]</code></pre>

          <ul>
            <li><code>even</code> serves as a callback to <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>Array.filter</code></a></li>
            <li>Callbacks can be inline, which should only be used if it improves readability (i.e. not for lengthy callbacks)</li>
          </ul>

          <pre><code class="js">console.log([1, 2, 3, 4, 5].filter(function () { 
  return n % 2; 
});</code></pre>
          <ul>
            <li>Anonymous functions/callbacks make debugging more difficult</li>
          </ul>
        </section>
        </section>

        <section>
          <section>
            <h2>Promises</h2>
          </section>
          <section>
            <ul>
              <li>A <em>promise</em> is an operation we expect to complete in the future</li>
            </ul>

            <pre><code class="js">function showWombats() {
  let wombats = getWombatsFromServer();
  displayWombats(wombats);
}</code></pre>

            <ul>
              <li> Unless <code>getWombatsFromServer()</code> is called synchronously in the code above, <code>wombats</code> will likely have an unexpected value</li>
            </ul>
            <aside class="notes" data-markdown>
              * In a synchronous language, program execution will pause until <code>getWombatsFromServer</code> returns. In JavaScript, execution will continue
              * Allows us to guarantee order of execution in an asynchronous language
            </aside>
          </section>
        <section>
          <ul>
            <li>Consider the same function using promises:</li>
          </ul>

            <pre><code class="js">function showWombats() {
  getWombatsFromServer().then(displayWombats);
}

function displayWombats(wombats) {
  // ...
}</code></pre>

          <ul>
            <li> Here we guarantee that the call to <code>displayWombats</code> won't occur until after the server request has returned, even if it takes several seconds to complete</li>
          </ul>
        </section>

        <section>
          <ul>
            <li>Calls to <code>then</code> can be chained to further control the order of execution:</li>
          </ul>

            <pre><code class="js">getWombatsFromServer()
  .then(tagWombats)
  .then(releaseWombats)
  .catch(catchWombats);</code></pre>

          <ul>
            <li>To catch rejected operations, either pass a second function to <code>then()</code>, or use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>catch</code></a>.</li>
          </ul>
        </section>
        </section>

        <section>
          <h2><code>async</code> / <code>await</code></h2>
          <ul>
            <li>In <em>ES7</em> (yep, another way) the <code>async</code>/<code>await</code> keywords provide another approach to asynchronous code</li>
          </ul>

          <pre><code class="js">async function showWombats() {
  let wombats = await getWombatsFromServer();
  displayWombats(wombats);
}</code></pre>

          <ul>
            <li>Also influences the method's signature</li>
          </ul>

            <aside class="notes" data-markdown>
              * Users of async/await in C# will find the syntax very familiar
              * Function execution only continues when the <code>await</code> resolves
            </aside>
        </section>

        <section>
          <h2>Further Reading</h2>

          <ul>
            <li><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> (MDN)</li>
            <li><a href="http://dailyjs.com/2014/02/20/promises-in-detail/">JavaScript Promises ... In Wicked Detail</a></li>
            <li><a href="http://bevacqua.github.io/promisees/">A Promise Visualiser</a></li>
            <li><a href="https://thomashunter.name/blog/the-long-road-to-asyncawait-in-javascript/">The Long Road to Async/Await in JavaScript</a></li>
            <li><a href="http://www.datchley.name/promise-patterns-anti-patterns/">Promise Patterns & Anti-Patterns</a></li>
          </ul>
        </section>

        <!-- SECTION 5 -->
        <section data-background="img/backgrounds/hippo_behind.jpg">
          <h1 class="offset-bottom">The Backend</h1>
        </section>

        <section>        
          <section>
            <h2>Node.js</h2>
            <ul>
              <li>Comprehensive protocol support</li>
              <li>Stream everything, no buffering</li>
              <li>JavaScript on the server using the V8 engine</li>
              <li>Single threaded, event-driven, non-blocking I/O</li>
            </ul>
            <aside class="notes" data-markdown>
              * Can be written in any language which can compiled to JavaScript, including [CoffeeScript](http://coffeescript.org), [TypeScript](http://typescriptlang.org), [Dart](http://dartlang.org), [ClojureScript](https://github.com/clojure/clojurescript), etc. 
              * V8 is a compiler, not an interpreter: implications for speed and resource consumption
              * Unlike browser-based JavaScript, Node has access to server resources including files on disk, networking, and other features of the operating system
              * Dates back to 2009, with a meteoric rise in popularity since then
            </aside>
          </section>

          <section>
            <ul>
              <li>A simple HTTP server written in Node</li>
            </ul>
            <pre><code class="js">var http = require('http');

http.createServer(function (request, response) {
  response.writeHead(200, {'Content-Type': 'text/plain'});
  response.end('Hello World\n');
}).listen(8124);

console.log('Server running at http://127.0.0.1:8124/');</code></pre>
          </section>

          <section>
            <h2>Non-blocking I/O</h2>
            <ul>
              <li>Node operates on a single thread</li>
              <li>I/O operate from a separate pool of threads managed by <a href="https://github.com/libuv/libuv">libuv</a></li>
              <li>Callbacks are coordinated through the <em>Event Demultiplexer</em>, out to the I/O operation and onto the stack through the <em>Callback Queue</em></li>
              <li>Node includes synchronous I/O for initialisation scenarios</li>
            </ul>
            <aside class="notes" data-markdown>
              * Part of Node's appeal is its ability to execute _asynchronous_ code
              * Node waits for a callback but can do other things while it waits. This behaviour is said to be _event-driven_ and is coordinated using the _event loop_.
              * Design allows thousands of concurrent requests
              * Can't make use of multi-core processors without explicitly handling child processes (for example, using the `cluster` module)
            </aside>
          </section>

          <section>
            <h2><code>require</code> versus <code>import</code></h2>
            <ul>
              <li>Node's module system came from <a href="https://en.wikipedia.org/wiki/CommonJS">CommonJS</a>. You may encounter a lot of code that looks like this:</li>
            </ul>
            <pre><code class="js">var http = require('http');
var foo = require('foo');</code></pre>
            <ul>
              <li>It's possible to use <em>ES6</em> <code>import</code>s with the help of a transpiler:</li>
            </ul>
            <pre><code class="js">import http from 'http';
import path from 'path';</code></pre>
          </section>

          <section>
            <h2>Transpilers</h2>
            <aside class="notes" data-markdown>
              * Because these features are fairly new to the language, it's necessary to use a _transpiler_ to translate the ES6 features of the language into something that can be readily understood by Node. As the toolset matures, this should gradually become unnecessary.
            </aside>

            <pre><code class="js">var gulp = require('gulp');
var babel = require('gulp-babel');

gulp.task('default', function() {
  return gulp.src('server.js')
    .pipe(babel())
    .pipe(gulp.dest('dist'));
});</code></pre>

            <ul>
              <li> Here we use <a href="https://babeljs.io">Babel</a> to process the server file, then output to the <code>dist</code> directory</li>
            </ul>
          </section>
        </section>

        <section>
          <section>
            <h2>Express</h2>
            <aside class="notes" data-markdown>
              * [Express](http://expressjs.com) is a minimalist web framework that sits on top of Node.
              * Has features for defining models, serving static content, and exposing APIs
            </aside>
          </section>

          <section>
            <ul>
              <li>A minimal HTTP server written with Express</li>
            </ul>
            <pre><code class="js">import http from 'http';
import path from 'path';
import express from 'express';

let router = express();
let server = http.createServer(router);

router.use(
  express.static(path.resolve(__dirname, '../client'))
);

server.listen(3000, "0.0.0.0", function(){
  console.log("Ok");
});</code></pre>

            <aside class="notes" data-markdown>
              * This serves everything in the `client` directory as static content
              * The port to listen on is held in the environment variable `$PORT`
            </aside>
          </section>

          <section>
            <h2>Everything is 'middleware'</h2>
            <ul>
              <li> Flow of execution is passed from middleware to middleware using the <code>next()</code> function.</li>
            </ul>
          </section>

          <section>
            <pre><code class="js">// app.js
import authenticate from 'authenticate';
import aardvarks from 'aardvarks';
app.use('/aardvarks', authenticate);
app.use('/aardvarks', aardvarks);

// authenticate.js
app.all('/aardvarks', function (req, res, next) {
  if (someUserAuthTest) next();
  res.status(401).json({ message: 'Please login.' });
});

// aardvarks.js
app.get('/aardvarks', function (req, res, next) {
  let aardvark = new Aardvark();
  res.json(aardvark);
});</code></pre>

            <aside class="notes" data-markdown>
              * In Express, almost every part of request handling is treated as _middleware_.
              * This provides security because the order of execution is guaranteed: the <code>authenticate</code> middleware will always execute before `aardvarks`
              * If the user fails authentication, a response is written with HTTP status code 401
              * Notice that before the call to next, the request object is modified directly with new information (the user object)
              * Careful: it's possible to accidentally overwrite properties on the request
              * Middleware can be built up in this fashion into a _middleware stack_
            </aside>
          </section>

          <section>
            <h2>Feathers</h2>
            <aside class="notes" data-markdown>
              * <a href="http://feathersjs.com">Feathers</a> is an <a href="#express">Express</a> wrapper that takes care of boilerplate tasks
              * Makes setting up a REST API fairly trivial:
            </aside>

            <pre><code class="js">import feathers from 'feathers';
import bodyParser from 'body-parser';
import mongoService from 'feathers-mongo';

let app = feathers()
  .configure(feathers.rest());
  .use(bodyParser.json())
  .use('aardvarks', new mongoService('aardvarks'));

let port = 8080;
app.listen(port, function () {
  console.log(`Listening for Orycteropus afer on ${port}...`);
});</code></pre>
          </section>

        </section>

        <section>
          <h2>Further reading</h2>
          <ul>
            <li><a href="http://blog.mixu.net/2011/02/01/understanding-the-node-js-event-loop/">Understanding the node.js event loop</a></li>
            <li><a href="https://nodejs.org/en/docs/es6/">Node's ES6 Support</a> (based on V8)</li>
          </ul>
        </section>


        <!-- SECTION 6 -->
        <section data-background="img/backgrounds/hippo_yawn.jpg">
          <h1 class="offset-top">Storage</h1>
        </section>

        <section>

          <section>
            <h2>MongoDB</h2>
            <aside class="notes" data-markdown>
              * Although in theory JavaScript can interact with almost any data store, [Mongo](https://www.mongodb.org) is one of the most common databases in modern JS stacks.
            </aside>
          </section>

          <section>
            <h2>NoSQL</h2>
            <h2>Schemaless</h2>
            <h2>Document Database</h2>
            <aside class="notes" data-markdown>
              * Most traditional databases are based on tables, and the relationships between them.
              * NoSQL databases come in a variety of designs. Mongo is of the _document store_ type.
              * Stores records in JSON format, encoded to binary format _BSON_
              * Tends to lump all related information together, rather than distribute it across relational tables
              * Although each document can be validated in code, they aren't required to be identical in structure
              * Mongo arranges documents into 'collections'. A database is made up of a set of collections.
            </aside>
          </section>

          <section>
            <h2>JSON</h2>
            <pre><code class="js">{
  "__v": 0,
  "_id": "55fb213fac8d99ce3fb1b47c",
  "name": "Fitzgerald",
  "stomachContents": [
    "ant", "ant", "termite", "ant"
  ],
  "latinName": {
    "genus": "Orycteropus",
    "species": "afer"
  },
  "nocturnal": true
}</code></pre>
          </section>

          <section>
            <ul>
              <li>Mongo accepts and returns documents as JSON documents</li>
              <li>If a record is returned in the body of a response, there is not need to <code>JSON.parse()</code> it ... it's already a JavaScript object</li>
              <li>Mongo will add an <code>ObjectId</code> (<code>_id</code>) property automatically, and possibly versioning information depending on settings</li>
            </ul>
          </section>
        </section>

        <section>
          <section data-background="img/backgrounds/mongoose.jpg">
            <h1 class="offset-bottom">Mongoose</h1>
            <aside class="notes" data-markdown>
              <ul>
                <li><a href="http://mongoosejs.com">Mongoose</a> is an object model for <a href="#mongodb">MongoDB</a>.</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2>Schemas</h2>
            <ul>
              <li>Mongoose gives each Mongo <em>collection</em> a <em>schema</em></li>
              <li> Allows types, defaults, and the opportunity to define static methods and middleware.</li>
              <li>Schemas can contain other schemas:</li>
            </ul>

            <pre><code class="js">let itemSchema = new Schema({
  name: String,
  color: String
});

let containerSchema = new Schema({
  name: String,
  items: [itemSchema]
});</code></pre>
          </section>

          <section>
            <h2>Models</h2>
            <ul>
              <li>As schemas are to collections, <em>models</em> are to <em>documents</em>.</li>
              <li>Models are created using a schema:</li>
            </ul>
              <pre><code class="js">let Wombat = mongoose.model('Wombat', wombatSchema);</code></pre>
          </section>

          <section>
            <ul>
              <li>Adding a document to the collection in the database requires creating a new instance of the model:</li>
            </ul>

            <pre><code class="js">let myWombat = new Wombat({
  name: "Holiday"
});

myWombat.save(function (err) {
  if (err) return handleError(err);
});</code></pre>
          </section>

          <section>
            <ul>
              <li>Schemas provide various methods for finding, altering and deleting documents:</li>
            </ul>

              <pre><code class="js">Wombat.findOne(
  {'name': 'Holiday'}, 
  'name', 
  function (err, wombat) {
    if (err) return handleError(err);
    console.log('Found her!');
  }
);</code></pre>

            <ul>
              <li>See <a href="http://mongoosejs.com/docs/queries.html">Queries</a> for further details.</li>
            </ul>
          </section>

          <section>
            <h2>Validation</h2>
            <ul>
              <li>One of the strongest reasons for using Mongoose is that validation is built in.</li>
              <li> For example, although properties are considered optional by default, they can be made required:</li>
            </ul>

            <pre><code class="js">import mongoose, {Schema} from 'mongoose';

let wombatSchema = new Schema({
  name: { type: String, required: true },
  nocturnal: Boolean
});</code></pre>

            <ul>
              <li><code>name</code> must be supplied but <code>nocturnal</code> can be omitted. Attempting to save a <code>Wombat</code> without a <code>name</code> string will cause a validation error.</li>
            </ul>
          </section>
        </section>

        <section>
          <section data-background="img/backgrounds/lion.jpg">
            <h1 class="offset-bottom">REST</h1>
            <aside class="notes" data-markdown>
              * Having established a means to store and retrieve data, the REST API serves as an HTTP interface between the client and the data store.
            </aside>
          </section>

          <section>
            <h2>Characteristics</h2>
            <ul>
              <li>Resources</li>
              <li>HTTP Verbs</li>
              <li>HTTP Status codes</li>
              <li>JSON requests and responses</li>
            </ul>
            <aside class="notes" data-markdown>
              <ul>
                <li>The REST API operates on the assumption that the client will be accessing the same base URL or <em>resource</em> (sometimes with additional parameters like ID numbers) but using different <em>HTTP verbs</em>.</li>
                <li> The server can return data in the <em>response body</em>, but it can also provide feedback in the form of the HTTP <em>status code</em>, and in 'strict' REST it should provide all the information necessary to navigate the site's resources.</li>
                <li> <a href="http://restcookbook.com/Basics/hateoas/">What is HATEOAS and why is it important for my REST API?</a> and <a href="http://www.timelessrepo.com/haters-gonna-hateoas">Haters gonna HATEOAS</a> for further context.</li>
                <li>In each case the address is the same or very similar, but the <em>HTTP verb</em> is different.</li>
                <li>This allows the server to behave differently depending on the request. For example, using Express:</li>
              </ul>
            </aside>
          </section>

          <section>
              <pre><code class="brainfuck">GET /wombats - same as visiting in a browser
  - HTTP status 200 for a successful request

GET /wombats/1 - Return a single wombat with id 1
  - 200 for success, 404 not found

POST /wombats - Create a wombat
  - 201 resource created, response body should contain it

PUT /wombats/1 - Edit or update the wombat with id 1
  - 200 resource edited, 204 if the body doesn't contain it

DELETE /wombats/1 - Remove the wombat with id 1
  - 200 for resource deleted, 204 if body doesn't contain it</code></pre>
          </section>
          <section>
            <pre><code class="js">router.route('/wombats')

  // GET /wombats
  .get((req, res) => {
    Wombat.find((err, wombats) => {
      respond(res, err, wombats);
    });
  })

function respond(res, err, wombats) {
  if (err) {
    res.send(err);
  } else {
    res.json(wombats);
  }
}</code></pre>
          </section>

          <section>
            <pre><code class="js">router.route('/wombats')
  // POST /wombats
  .post((req, res) => {
    let wombat = new Wombat();
    wombat.name = req.body.name;
    wombat.save((err) => {
      respond(res, err, wombat);
    });
  });</code></pre>


            <aside class="notes" data-markdown>
              <ul>
                <li> Here, Express uses a different function for GET and POST verbs even though the address visited is identical.</li>
                <li> In the case of GET, since there is no ID specified, it simply returns an array of wombats (as JSON).</li>
                <li> For POST, it looks for a wombat in `req.body`, checks the <code>name</code> specified and saves it to MongoDB.</li>
              </ul>
            </aside>
          </section>

          <section>
            <aside class="notes" data-markdown>
              <ul>
                <li>We can also tell Express to respond differently if a resource ID has been specified:</li>
              </ul>
            </aside>

            <pre><code class="js">router.route('/wombats/:id')

  // GET /wombats/12345
  .get((req, res) => {
    Wombat.findById(req.params.id, (err, wombat) => { 
      respond(res, err, wombat); 
    });
  })

  // PUT /wombats/12345
  .put((req, res) => {
    Wombat.findByIdAndUpdate(req.params.id, req.body, 
      (err, wombat) => {
        respond(res, err, wombat);
      }
    );
  })</code></pre>
          </section>

          <section>
            <pre><code class="js">router.route('/wombats/:id')

  // DELETE /wombats/12345
  .delete((req, res) => {
    Wombat.findByIdAndRemove(req.params.id, req.body, 
      (err, wombat) => {
        respond(res, err, wombat);
      }
    );
  });</code></pre>

              <ul>
                <li> Express places the <code>id</code> in `req.params.id`.</li>
                <li> The functions <code>findById</code>, <code>findByIdAndUpdate</code> and <code>findByIdAndRemove</code> are provided by Mongoose.</li>
              </ul>
          </section>

          <section>
            <h2>Async Implications</h2>
            <aside class="notes" data-markdown>
              <ul>
                <li>Requests to the database take place in unknown time</li>
                <li> The database or server could be under heavy load</li>
                <li> The network infrastructure may be impaired</li>
                <li> Further cloud resources (additional servers, containers, database instances) may be in the process of coming online</li>
                <li>We cannot <em>know</em> when the request will return with data (or an error)</li>
                <li>We need a way to guarantee that the values we're expecting won't be accessed until after the call to the database has completed</li>
              </ul>
            </aside>

            <pre><code class="js">router.route('/wombats/:id').get(retrieveOneWombat);

function retrieveOneWombat(req, res) {
  Wombat.findById(req.params.id, sendWombatResponse);
}

function sendWombatResponse(err, wombat) {
  if (err) {
    res.send(err);
  } else {
    res.json(wombat);
  }
}</code></pre>
          </section>

          <section>
            <aside class="notes" data-markdown>
              <ul>
                <li> This is a simple re-working of the sample code in the previous section, avoiding the use of inline functions for clarity.</li>
                <li> There are two callbacks: <code>retrieveOneWombat</code> and <code>sendWombatResponse</code>.</li>
                <li> When Express receives a request to this URL (resource) with the HTTP verb <code>GET</code>, it calls <code>retrieveOneWombat</code></li>
                <li> When the Mongoose model <code>Wombat</code>'s method <code>findById</code> has finished hitting the database, it calls <code>sendWombatResponse</code></li>
                <li> This gives us some assurance that our data is actually there, or if it isn't that an error has been generated which we can return.</li>
              </ul>
            </aside>
            <ul>
              <li>Newer versions of Mongoose also support promises, so you can use:</li>
            </ul>
            <pre><code class="js">router.route('/wombats/:id')
  .get((req, res) => {
    Wombat
      .findById(req.params.id)
      .then((wombat) => {
        // ...
        res.json(wombat);
      });
  });</code></pre>
          </section>
        </section>

        <section data-background="img/aardvark.gif">
          <h1>Thank You!</h1>
        </section>

        <section>
          <section data-background="img/backgrounds/cranes.jpg">
            <h1>Attributions</h1>
          </section>

          <section>
            <p>All images Creative Commons licensed (commercial use).</p>
            <p>
              <a href="https://www.flickr.com/photos/tompagenet/">Tom Page</a>, 
              <a href="https://www.flickr.com/photos/swallowtailgardenseeds/">Swallowtail Garden Seeds</a>, 
              <a href="https://www.flickr.com/photos/42244964@N03/">Frank Vassen</a>, 
              <a href="https://www.flickr.com/photos/dianasch/">Diana Robinson</a>, 
              <a href="https://www.flickr.com/photos/usfwsmidwest/">USFWSmidwest</a>, 
              <a href="https://www.flickr.com/photos/tehbieber/">Robert Bieber</a>, 
              <a href="https://www.flickr.com/photos/islandgyrl/">Christine Olson</a>, 
              <a href="https://www.flickr.com/photos/puliarfanita/">Anita Ritenour</a>, 
              <a href="https://www.flickr.com/photos/judemasti/">smalljude</a>, 
              <a href="https://www.flickr.com/photos/t3rmin4t0r/">Gopal Vijayaraghavan</a>, 
              <a href="https://www.flickr.com/photos/tom_hall_nz/">Tom Hall</a>, 
              <a href="https://www.flickr.com/photos/72562013@N06/">Chris Phutully</a>, 
              <a href="https://www.flickr.com/photos/42244964@N03/">Frank Vassen</a>, 
              <a href="https://www.flickr.com/photos/24874528@N04/">Airwolfhound</a>, 
              <a href="https://www.flickr.com/photos/tambako/">Tambako the Jaguar</a>,
              <a href="https://www.flickr.com/photos/arcticwoof/">Arctic Wolf</a>, 
              <a href="https://www.flickr.com/photos/martinteschner/">Martin Teschner</a>, 
              <a href="https://www.flickr.com/photos/dave_see/">dave.see</a>, 
              <a href="https://www.flickr.com/photos/dkeats/">Derek Keats</a> 
            </p>
          </section>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

// Full list of configuration options available at:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
  width: '90%',
  height: '100%',
  controls: true,
  progress: true,
  history: true,
  center: true,

  transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
  dependencies: [
  { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
  { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
  { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
    { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
  ]
});

    </script>

  </body>
</html>
